---
import Layout from "../layouts/Layout.astro";
import { ResetPasswordForm } from "../components/ResetPasswordForm";

// Nie implementujemy jeszcze pełnej logiki - to przyjdzie w kolejnym etapie
export const prerender = false;

const url = new URL(Astro.request.url);
const code = url.searchParams.get("code");

// Jeśli brak kodu, przekieruj do forgot-password (w przyszłości)
// Na razie tylko sprawdzamy obecność kodu
if (!code) {
  // TODO: W kolejnym etapie dodać przekierowanie
  // return Astro.redirect("/forgot-password");
}
---

<Layout title="Resetuj hasło - MIMO">
  <main
    class="min-h-screen bg-gradient-to-br from-primary/5 via-background to-secondary/10 flex items-center justify-center p-4"
  >
    <div class="w-full">
      {
        code ? (
          <ResetPasswordForm client:load code={code} />
        ) : (
          <div class="w-full max-w-md mx-auto">
            <div class="bg-card rounded-xl shadow-lg border border-border p-8">
              <div class="text-center space-y-4">
                <div class="w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto">
                  <svg
                    class="w-8 h-8 text-destructive"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-foreground">Nieprawidłowy link</h2>
                <p class="text-muted-foreground">
                  Link do resetowania hasła jest nieprawidłowy lub wygasł. Poproś o nowy link resetujący.
                </p>
                <div class="pt-4">
                  <a
                    href="/forgot-password"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-4 py-2 bg-primary text-primary-foreground shadow-xs hover:bg-primary/90 transition-all"
                  >
                    Poproś o nowy link
                  </a>
                </div>
              </div>
            </div>
          </div>
        )
      }
    </div>
  </main>
</Layout>
